\ProvidesPackage{hrfmath}[2020/04/19 Math setup, should be loaded after hrfgerman]

% for options
\RequirePackage{etoolbox}
\RequirePackage{pgfopts}
% package options
% theorem numbering style
\newtoggle{numberindividually}
\newtoggle{nomasternumbers}
\newtoggle{numberwithin}
\newtoggle{empheqoverload}
\pgfkeys{
	/hrftex/hrfmath/.cd,
	numberindividually/.is choice,
	numberindividually/true/.code=\toggletrue{numberindividually},
	numberindividually/false/.code=\togglefalse{numberindividually},
	numberindividually/.initial=false,
	numberindividually/.default=true,
	nomasternumbers/.is choice,
	nomasternumbers/true/.code=\toggletrue{nomasternumbers},
	nomasternumbers/false/.code=\togglefalse{nomasternumbers},
	nomasternumbers/.initial=false,
	nomasternumbers/.default=true,
	empheqoverload/true/.code=\toggletrue{empheqoverload},
	empheqoverload/false/.code=\togglefalse{empheqoverload},
	empheqoverload/.initial=false,
	empheqoverload/.default=true,
	numberwithin/.value required,
	numberwithin/.initial,
}
% 


\ProcessPgfOptions{/hrftex/hrfmath}
\toggletrue{nontheorem}
% Process numberwithin
\pgfkeys{/hrftex/hrfmath/numberwithin/.get=\numbertheoremswithinthis}
\def\novaluegiven{\pgfkeysnovalue}
\ifdefequal{\numbertheoremswithinthis}{\novaluegiven}{\togglefalse{numberwithin}}{\toggletrue{numberwithin}}

% this will already be loaded if used from hrftex
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}

% Fix problems with too many math fonts
\newcommand\hmmax{0}
\newcommand\bmmax{0}


% main math package
\RequirePackage{mathtools}

% better \left, \right spacing
\RequirePackage{mleftright}
\mleftright % redefine \left to \mleft and \right to \mright

% better boxed equations, better endtheoremmark placement
\iftoggle{empheqoverload}{\PassOptionsToPackage{overload}{empheq}}{}
\iftoggle{nontheorem}{}{\PassOptionsToPackage{ntheorem}{empheq}}
\RequirePackage{empheq}

% Possibility to change between left and right equation numbers
\newcommand{\leqnomode}{\tagsleft@true}
\newcommand{\reqnomode}{\tagsleft@false}

\RequirePackage{amssymb}
\RequirePackage{amstext}

% for \mathds{1}
\RequirePackage{dsfont}

% add \warning symbol
\newcommand*{\TakeFourierOrnament}[1]{{%
			\fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
\newcommand*{\warning}{\TakeFourierOrnament{49}}

% 

% for some symbols (hopefully documented when used)
\RequirePackage{stmaryrd}


% lowercase mathcal
\RequirePackage{dutchcal} % \mathcal: also small letters. \mathbcal = bold ones. 

% mathscr and calligraphic font (e.g. for curly Hom)
\RequirePackage{mathrsfs}

% for theorems
\iftoggle{nontheorem}{
\RequirePackage{amsthm}
\renewcommand{\qedsymbol}{$\blacksquare$}
\newenvironment{subproof}[1][{}]{\ifthenelse{\equal{#1}{}}{\begin{proof}}{\begin{proof}[{#1}]}\renewcommand{\qedsymbol}{$\square$}}{\end{proof}}
}{
\PassOptionsToPackage{amsmath, thmmarks, amsthm}{ntheorem}
\RequirePackage{ntheorem}
\usetagform{default}
\gdef\proofSymbol{\ensuremath{\blacksquare}} % so that the square can be used for subproofs
\newenvironment{subproof}[1][{}]{\ifthenelse{\equal{#1}{}}{\begin{proof}}{\begin{proof}[{#1}]}\def\proofSymbol{\ensuremath{\square}}}{\end{proof}}
}
\RequirePackage{thmtools}
\RequirePackage{thm-restate}


% consistent numbering
\declaretheoremstyle{standardThmStyle}
\theoremstyle{standardThmStyle}
\iftoggle{numberwithin}{\declaretheorem[numberwithin=\numbertheoremswithinthis,name={}]{generalthm}}{\declaretheorem[name={}]{generalthm}}
\let\generalthm*\relax
\declaretheorem[name={},numbered=no]{generalthm*}

% for references to items in enumerations
\iftoggle{noenumitem}{}{
	\setlist[enumerate,1]{label=(\roman*), ref=\iftoggle{numberindividually}{}{\thegeneralthm.}(\roman*)}
	\newlist{eigenschaftenenumerate}{enumerate}{3}
	\setlist[eigenschaftenenumerate]{label=(\alph*), ref=\iftoggle{numberindividually}{}{\thegeneralthm.}(\alph*)}
	\newlist{eigenschaftendescription}{description}{3}
	\setlist[eigenschaftendescription]{font=\normalfont}
	\newlist{proofenumerate}{enumerate}{3}
	\setlist[proofenumerate]{label=\arabic*., wide}
	\newlist{proofdescription}{description}{3}
	\setlist[proofdescription]{font=\bfseries, wide}
	% for references to description items
	\def\namedlabel#1#2{\begingroup
		#2%
		\def\@currentlabel{#2}%
		\phantomsection\label{#1}\endgroup
	}}

\newcommand{\NewTheorem}[2]{
	\iftoggle{numberindividually}
	{\iftoggle{numberwithin}
		{\declaretheorem[name=#2,numberwithin=\numbertheoremswithinthis]{#1}}
		{\declaretheorem[name=#2]{#1}}}
	{\declaretheorem[numberlike=generalthm,name=#2]{#1}}
	\iftoggle{nontheorem}{}{
		\expandafter\let\csname #1*\endcsname\relax % ntheorem defines starred variants which we don't want
	}
	\declaretheorem[name=#2, numbered=no]{#1*}
	\iftoggle{nomasternumbers}{\expandafter\renewcommand\csname the#1\endcsname{\arabic{#1}}}{}
}

% beamer defines its own theorems
\@ifclassloaded{beamer}{}{
	\NewTheorem{anwendung}{Anwendung}
	\NewTheorem{anwendungen}{Anwendungen}
	\NewTheorem{aufwaermuebung}{Aufwärm-Übung}
	\NewTheorem{attention}{\warning}
	\NewTheorem{achtung}{\emph{Achtung}}
	\NewTheorem{beachte}{Beachte}
	\NewTheorem{beispiel}{Beispiel}
	\NewTheorem{antibeispiel}{Anti-Beispiel}
	\NewTheorem{beispiele}{Beispiele}
	\NewTheorem{behauptung}{Behauptung}
	\NewTheorem{behauptungen}{Behauptungen}
	\NewTheorem{bembsp}{Bemerkung / Beispiel}
	\NewTheorem{bembspe}{Bemerkungen / Beispiele}
	\NewTheorem{bemdef}{Bemerkung / Definition}
	\NewTheorem{bemnotation}{Bemerkung / Notation}
	\NewTheorem{bemuebung}{Bemerkung / Übung}
	\NewTheorem{bemerkung}{Bemerkung}
	\NewTheorem{bemerkungen}{Bemerkungen}
	\NewTheorem{bspdef}{Beispiel / Definition}
	\NewTheorem{bspidee}{Beispiel / Idee}
	\NewTheorem{checkenvironment}{Check}
	\NewTheorem{claim}{Claim}
	\NewTheorem{claims}{Claims}
	\NewTheorem{construction}{Construction}
	\NewTheorem{corollary}{Corollary}
	\NewTheorem{defbem}{Definition / Bemerkung}
	\NewTheorem{deferinnerung}{Definition / Erinnerung}
	\NewTheorem{definition}{Definition}
	\NewTheorem{definitionen}{Definitionen}
	\NewTheorem{deflemma}{Definition / Lemma}
	\NewTheorem{defprop}{Definition / Proposition}
	\NewTheorem{defsatz}{Definition / Satz}
	\NewTheorem{einschub}{Einschub}
	\NewTheorem{ergaenzung}{Ergänzung}
	\NewTheorem{example}{Example}
	\NewTheorem{examples}{Examples}
	\NewTheorem{exercise}{Exercise}
	\NewTheorem{exkurs}{Exkurs}
	\NewTheorem{erinnerung}{Erinnerung}
	\NewTheorem{fact}{Fact}
	\NewTheorem{fakt}{Fakt}
	\NewTheorem{folgerung}{Folgerung}
	\NewTheorem{folgerungbsp}{Folgerung / Beispiel}
	\NewTheorem{folgerungenbsp}{Folgerungen / Beispiele}
	\NewTheorem{folgerungen}{Folgerungen}
	\NewTheorem{folgnotation}{Folgerungen / Notation}
	\NewTheorem{frage}{Frage}
	\NewTheorem{frageuebung}{Frage / Übung}
	\NewTheorem{fragen}{Fragen}
	\NewTheorem{goal}{Goal}
	\NewTheorem{hint}{Hint}
	\NewTheorem{idea}{Idea}
	\NewTheorem{idee}{Idee}
	\NewTheorem{interpretation}{Interpretation}
	\NewTheorem{intuition}{Intuition}
	\NewTheorem{lemmadef}{Lemma + Def}
	\NewTheorem{lemma}{Lemma}
	\NewTheorem{konvention}{Konvention}
	\NewTheorem{korollar}{Korollar}
	\NewTheorem{notabene}{Nota Bene}
	\NewTheorem{notation}{Notation}
	\NewTheorem{notationen}{Notationen}
	\NewTheorem{note}{Note}
	\NewTheorem{notice}{Notice}
	\NewTheorem{merkregel}{Merkregel}
	\NewTheorem{motivation}{Motivation}
	\NewTheorem{proposition}{Proposition}
	\NewTheorem{question}{Question}
	\NewTheorem{recall}{Recall}
	\NewTheorem{rechentrick}{Rechentrick}
	\NewTheorem{remark}{Remark}
	\NewTheorem{remarkconvention}{Remark / Convention}
	\NewTheorem{remarkdef}{Remark / Definition}
	\NewTheorem{satz}{Satz}
	\NewTheorem{satzdef}{Satz / Definition}
	\NewTheorem{slogan}{Slogan}
	\NewTheorem{spezialfall}{Spezialfall}
	\NewTheorem{theorem}{Theorem}
	\NewTheorem{thmdef}{Theorem \& Definition}
	\NewTheorem{tocome}{To Come}
	\NewTheorem{wiederholung}{Wiederholung}
	\NewTheorem{ziel}{Ziel}

	\newtheorem{subsatz}{Satz}[generalthm]
	\renewcommand{\thesubsatz}{\thegeneralthm.\arabic{subsatz}}
}
% stack below with optional argument
\RequirePackage{stackrel}

% left and right sub- and superscripts
\RequirePackage{leftidx}

% for composed symbols including a colon
\RequirePackage{colonequals}


% tikz with most important libraries
\RequirePackage{tikz}
\usetikzlibrary{matrix, arrows, cd, patterns, babel, calc}
\RequirePackage{tkz-euclide}

\RequirePackage{cancel}

% Bold math
\RequirePackage{bm}

% Easily typeset systems of equations (French package)
\RequirePackage{systeme}


% Roman numerals
\RequirePackage{romannum}

% Nice Matrices and Arrays
\RequirePackage{nicematrix}

% Large Matrices
\setcounter{MaxMatrixCols}{20}

% Units
\RequirePackage[locale=DE]{siunitx}

% Add \contra symbol to denote contradiction
\RequirePackage{stmaryrd} % for \lightning
\newcommand\contra{\scalebox{1.5}{$\lightning$}}


\definecolor{correct}{HTML}{009900}
\newcommand\correct[2]{\ensuremath{\:}{\color{red}{#1}}\ensuremath{\to }{\color{correct}{#2}}\ensuremath{\:}}
\newcommand\green[1]{{\color{correct}{#1}}}



% si unitx
\RequirePackage{siunitx}
\sisetup{locale = DE}



% \RequirePackage{cool} % kind of bad package
% \Style{ArcTrig=arc, Conjugate=overline}

\PassOptionsToPackage{upright=false}{derivative}
\RequirePackage{derivative}
\derivset{\pdv}[delims-eval=. \rvert]

% tensors
\RequirePackage{tensor}

% Better vector arrows
\RequirePackage{esvect}

% Intervals
\RequirePackage{interval}
\intervalconfig{
	soft open fences,
	scaled
}

% end of package imports


\def\DeclareMathOperatorWithDelimiter#1#2[#3,#4]#5#6#7#8{
\newcommand{#2}{}
\WithSuffix\DeclarePairedDelimiterXPP#2+[#3]{#5}{#6}{#7}{}{#8} %  #2+ with delimiters, #2+*: auto scales, #2+[<size-command>] sets delimiters to size
\WithSuffix\newcommand#2-[#3]{#5 #8} % #1-:no delimiters
\WithSuffix\newcommand#2;[\ifstrempty{#4}{\the\numexpr #3-1\relax}{#4}]{#5} % #2;: (with #2-1 arguments) only prints #4
\expandafter\let\csname  \NoSuffixName#2\expandafter\endcsname\csname\SuffixName#2#1\endcsname
}
\def\DeclareFunction#1#2[#3,#4]#5#6{
	\DeclareMathOperatorWithDelimiter#1{#2}[#3,#4]{#5}{\lparen}{\rparen}{#6}
}
\def\DeclareMathPostOperatorWithDelimiter#1#2[#3]#4#5#6#7{
\newcommand{#2}{}
\WithSuffix\DeclarePairedDelimiterXPP#2+[#3]{}{#5}{#6}{#4}{#7} %  #2+ variant, #2+*: auto scales, #2+[<size-command>] sets delimiters to size
\WithSuffix\newcommand#2-[#3]{{#7}#4} % #1-: no delimiters
\expandafter\let\csname  \NoSuffixName#2\expandafter\endcsname\csname\SuffixName#2#1\endcsname
}

\def\DeclarePostFunction#1#2[#3]#4#5{
	\DeclareMathPostOperatorWithDelimiter#1{#2}[#3]{#4}{\lparen}{\rparen}{#5}
}


% Note: if you want to swap the default after definition, or otherwise redefine a MOWD or MPOWD macro, first define a new MOWD or MPOWD macro with a new name and then \let it to the old macro name.


% allow a page break within amsmath math formulas,
% use \\* to prohibit a page break
\allowdisplaybreaks[1]


% possibility to ignore height and apply later (with SavedHeight)
\newsavebox{\mastercontent}
\newsavebox{\slavecontent}
\newsavebox{\masterheight}
\newsavebox{\slaveheight}
\newsavebox{\masterwidth}
\newsavebox{\slavewidth}
\newsavebox{\compositeheight}
\newsavebox{\compositewidth}


% provides \slavecontent and \mastercontent to access content, \slaveheight and \masterheight to access height, \slavewidth and \masterwidth to access width
\newcommand\heightcontext[2]{\sbox{\slavecontent}{\( #1 \)}\sbox{\mastercontent}{\(#2\)}\sbox{\slaveheight}{\vphantom{\usebox{\slavecontent}}}\sbox{\masterheight}{\vphantom{\usebox{\mastercontent}}}\sbox{\slavewidth}{\hphantom{\usebox{\slavecontent}}}\sbox{\masterwidth}{\hphantom{\usebox{\mastercontent}}}}


% number this specific equation
\newcommand{\numberthis}{\addtocounter{equation}{1}\tag{\theequation}}


% phantom relations for better alignment
\newcommand{\rphantom}[1]{\mathrel{\phantom{#1}}}


% vertical variants of relations
\newcommand{\vertrelation}[1]{\protect\rotatebox{90}{\(\scriptstyle#1\)}}
\newcommand{\vertlt}{\vertrelation{<}}
\newcommand{\vertleq}{\vertrelation{\leq}}
\newcommand{\vertgt}{\vertrelation{>}}
\newcommand{\vertgeq}{\vertrelation{\geq}}
\newcommand{\vertne}{\vertrelation{\ne}}
\newcommand{\vertin}{\vertrelation{\in}}
\newcommand{\vertni}{\vertrelation{\ni}}

% first (optional) argument - size, then explanation, then whats to be explained
% should be used in math mode
\newcommand{\equalto}[3][]{\underset{\scriptstyle\overset{\mkern4mu\scalebox{1}[0.7]{\verteq[#1]}}{\mathclap{#2}}}{#3}}
% accepts vertical relation as first necessary (can be made with vertrelation)
\newcommand{\underrelate}[4][]{\underset{\overset{\csname #1\endcsname{#2}}{\mathclap{#3}}}{#4}}
\newcommand{\overrelate}[4][]{\overset{\underset{\csname #1\endcsname{#2}}{\mathclap{#3}}}{#4}}
\newcommand{\explain}[3][]{\underrelate[#1]{\uparrow}{#2}{#3}}
\newcommand{\undersubset}[3][]{\underrelate[#1]{\vertrelation{\subset}}{#2}{#3}}
\newcommand{\undersupset}[3][]{\underrelate[#1]{\vertrelation{\supset}}{#2}{#3}}


\newcommand{\braceannotate}[2]{\ThisStyle{\underbrace{\SavedStyle #2}_{#1}}}

% adjustable size
\newcommand{\verteq}[1][]{\protect\raisebox{2pt}{\scalebox{1}[0.7]{\(\csname #1\endcsname{\Vert}\)}}}

% for use over relations
\newcommand{\needed}[1]{\overset{!}{#1}}
\newcommand{\isittrue}[1]{\overset{?}{#1}}

\newcaptionname{english}{\zuzeigentext}{To be shown: }
\newcaptionname{ngerman}{\zuzeigentext}{$\mathrm{Z\kern-.55em\raise-0.5ex\hbox{Z}}$ }

% can be used in both math and text mode
\newcommand{\zuzeigen}[1]{\smallskip\par\noindent\doublebox{%
		\begin{minipage}{\the\dimexpr \textwidth - 13.6pt\relax}\zuzeigentext #1\end{minipage}}}
\newcommand{\zuzeigenmath}[1]{\par\doublebox{%
		\begin{minipage}{\the\dimexpr\textwidth-\mathindent-13.6pt\relax}\zuzeigentext #1\end{minipage}}}
\let\tobeshown\zuzeigen
\let\tobeshownmath\zuzeigenmath

% verbose definitions
\newcommand*{\defines}{\eqqcolon}
\newcommand*{\definedas}{\coloneqq}
\newcommand*{\definedequivalentto}{\vcentcolon\Leftrightarrow}
\newcommand*{\maps}{\colon}
\newcommand*{\isomorphic}{\simeq}
\newcommand*{\isomorphismto}{\xrightarrow{\sim}}
\newcommand*{\onetoone}{\xleftrightarrow{1:1}}
\newcommand*{\into}{\hookrightarrow}
\newcommand*{\onto}{\twoheadrightarrow}
\newcommand*{\bijectionto}{\lhook\joinrel\twoheadrightarrow}
\newcommand{\xto}[2][]{\xrightarrow[#1]{#2}} % \to with subscript #1 and supscript #2

% for equivalence proofs
\RequirePackage{csquotes}
\newcommand*{\hin}{{\enquote{\( \implies \)}}}
\newcommand*{\rueck}{\enquote{\( \impliedby \)}}
\newcommand*{\hinrueck}{\enquote{\( \iff \)}}
\newcommand*{\sethin}{{\enquote{\( \subset \)}}}
\newcommand*{\setrueck}{{\enquote{\( \supset \)}}}


% equation sign with sim sign over it
\DeclareRobustCommand{\simeqq}{\cong}

% Better logic spacing
\newcommand*{\logicspace}{\hspace{0.5em}}

% Make quantifiers operators
\let\oldexists\exists
\let\exists\relax
\DeclareMathOperator{\exists}{\oldexists}

\let\oldforall\forall
\let\forall\relax
\DeclareMathOperator{\forall}{\oldforall}

% to avoid warnings about "!"
\DeclareMathOperator{\existsunique}{\exists!}

\DeclareFunction+{\anzahl}[1,]{\#}{#1}

% add \ndivides as does not divide
\newcommand*{\divides}{\mid}
\newcommand*{\ndivides}{\nmid}

% Add angled v as \varv
\DeclareSymbolFont{matha}{OML}{txmi}{m}{it} % txfonts
\DeclareMathSymbol{\varv}{\mathord}{matha}{118}


% overline replacement
\newcommand{\widebar}[1]{\mathop{\overline{#1}}}

% wider widetilde 
\RequirePackage{scalerel}
\RequirePackage{stackengine,wasysym}
\newcommand\reallywidetilde[1]{\ThisStyle{%
		\setbox0=\hbox{$\SavedStyle#1$}%
		\stackengine{-.1\LMpt}{$\SavedStyle#1$}{%
			\stretchto{\scaleto{\SavedStyle\mkern.2mu\AC}{.5150\wd0}}{.6\ht0}%
		}{O}{c}{F}{T}{S}%
	}}



% Replace leq and req signs
\let\leqold=\leq
\let\leqqold=\leqq
\let\geqold=\geq
\let\geqqold=\geqq
\let\triaglelefteqold=\trianglelefteq
\let\triaglerighteqold=\trianglerighteq
\renewcommand*{\leq}{\leqslant}
\renewcommand*{\leqq}{\leqqslant}
\renewcommand*{\geq}{\geqslant}
\renewcommand*{\geqq}{\geqqslant}
\renewcommand*{\trianglelefteq}{\trianglelefteqslant}
\renewcommand*{\trianglerighteq}{\trianglerighteqslant}
\newcommand*{\propersubgroup}{\le}
\newcommand{\normalsubgroup}{\trianglelefteq}
\newcommand{\ideal}{\trianglelefteq}
\newcommand{\propernormalsubgroup}{\triangleleft}
\newcommand*{\propersupgroup}{\ge}
\newcommand*{\subgroup}{\leqold}
\newcommand*{\supgroup}{\geqold}
\newcommand*{\subspace}{\leqold}
\newcommand*{\supspace}{\geqold}

% easier long to
\newcommand*{\longto}{\longrightarrow}

% verbose limits
\newcommand*{\goesto}{\to}
\newcommand*{\goesupto}{\nearrow}
\newcommand*{\goesdownto}{\searrow}

\newcommand*{\differential}{\mathop{}\!d}
\newcommand*{\improperdifferential}[1]{d#1\,} % here for backwards compatibility, please use \odif from the package "derivative"
\DeclareFunction-{\liederivative}[2,]{\mathcal{L}_{#1}}{#2}
\DeclareFunction-{\directionalderivative}[2,]{\partial_{#1}}{#2}
\DeclareFunction-{\totalderivative}[1,]{D}{#1}
\DeclareFunction-{\tangentmap}[1,]{T}{#1}
\newcommand{\covariantderivativealongcurve}[2]{\frac{D#1}{\odif{#2}}}

% For complex
\DeclareFunction+{\real}[1,]{\mathrm{Re}}{#1}
\DeclareFunction+{\imaginary}[1,]{\mathrm{Im}}{#1}
\newcommand{\conjugate}[1]{\widebar{#1}\nolimits}

% sets

% Set and Braket macros
% just to make sure it exists
\providecommand\given{}
% can be useful to refer to this outside \Set or \Braket
\newcommand\SetSymbol[1][]{%
	\nonscript\:#1\vert
	\allowbreak
	\nonscript\:
	\mathopen{}
}

\DeclarePairedDelimiterX\Set[1]{\lbrace}{\rbrace}{%
	\renewcommand\given{\SetSymbol[\delimsize]}
	#1
}
\DeclarePairedDelimiterX\braket[2]{\langle}{\rangle}{#1\delimsize\vert #2}
\DeclarePairedDelimiterX\appliedbraket[3]{\langle}{\rangle}{#1\delimsize\vert #2\delimsize\vert #3}
\DeclarePairedDelimiter\bra{\langle}{\rvert}
\DeclarePairedDelimiter\ket{\lvert}{\rangle}

% Prettier emptyset
\renewcommand{\emptyset}{\varnothing}

\newcommand*{\zeroset}{{\Set{0}}}
\newcommand*{\minuszero}{{\setminus\zeroset}}
\newcommand*{\Minuszero}{{\!\setminus\!\zeroset}}
\DeclarePairedDelimiterXPP{\powerset}[1]{\mathbb{P}}{\lparen}{\rparen}{}{#1}


\newcommand*{\naturals}{\mathbb{N}}
\newcommand*{\integers}{\mathbb{Z}}
\newcommand*{\rationals}{\mathbb{Q}}
\newcommand*{\reals}{\mathbb{R}}
\newcommand*{\complexes}{\mathbb{C}}
\newcommand*{\standardfield}{\mathbb{K}} % reals or complexes

% min and max with delimiters
\let\min\relax
\DeclareMathOperator{\min}{min}
\let\Min\relax
\DeclareFunction+{\Min}[1,]{\min}{#1}
\let\max\relax
\DeclareMathOperator{\max}{max}
\let\Max\relax
\DeclareFunction+{\Max}[1,]{\max}{#1}
\DeclareFunction+{\Med}[3,0]{\operatorname{med}}{#1,#2,#3}

% make trigonometric functions operators with delimiters
\let\Sin\relax
\DeclareFunction+{\Sin}[1,]{\sin}{#1}
\let\Cos\relax
\DeclareFunction+{\Cos}[1,]{\cos}{#1}
\let\Tan\relax
\DeclareFunction+{\Tan}[1,]{\tan}{#1}
\let\Sec\relax
\DeclareFunction+{\Sec}[1,]{\sec}{#1}
\let\Csc\relax
\DeclareFunction+{\Csc}[1,]{\csc}{#1}
\let\Cot\relax
\DeclareFunction+{\Cot}[1,]{\cot}{#1}
\let\Sinh\relax
\DeclareFunction+{\Sinh}[1,]{\sinh}{#1}
\let\Cosh\relax
\DeclareFunction+{\Cosh}[1,]{\cosh}{#1}
\let\Tanh\relax
\DeclareFunction+{\Tanh}[1,]{\tanh}{#1}
\let\Sech\relax
\DeclareFunction+{\Sech}[1,]{\sech}{#1}
\let\Csch\relax
\DeclareFunction+{\Csch}[1,]{\csch}{#1}
\let\Coth\relax
\DeclareFunction+{\Coth}[1,]{\coth}{#1}
\let\ArcSin\relax
\DeclareFunction+{\ArcSin}[1,]{\arcsin}{#1}
\let\ArcCos\relax
\DeclareFunction+{\ArcCos}[1,]{\arccos}{#1}
\let\ArcTan\relax
\DeclareFunction+{\ArcTan}[1,]{\arctan}{#1}
\let\ArcSec\relax
\DeclareFunction+{\ArcSec}[1,]{\arcsec}{#1}
\let\ArcCsc\relax
\DeclareFunction+{\ArcCsc}[1,]{\arccsc}{#1}
\let\ArcCot\relax
\DeclareFunction+{\ArcCot}[1,]{\arccot}{#1}
\let\ArcCosh\relax
\DeclareFunction+{\ArcCosh}[1,]{\operatorname{arccosh}}{#1} % \ArcCosh of #1 
\let\ArcSinh\relax
\DeclareFunction+{\ArcSinh}[1,]{\operatorname{arcsinh}}{#1} % \ArcSinh of #1 
\let\ArcTanh\relax
\DeclareFunction+{\ArcTanh}[1,]{\operatorname{arctanh}}{#1} % \ArcTanh of #1 
\let\ArcSech\relax
\DeclareFunction+{\ArcSech}[1,]{\operatorname{arcsech}}{#1} % \ArcSech of #1 
\let\ArcCsch\relax
\DeclareFunction+{\ArcCsch}[1,]{\operatorname{arccsch}}{#1} % \ArcCsch of #1 
\let\ArcCoth\relax
\DeclareFunction+{\ArcCoth}[1,]{\operatorname{arccoth}}{#1} % \ArcCoth of #1 

% from M&W
\DeclareFunction+{\standardprobabilityspace}[3,1]{\Omega_{\Romannum{#1}}}{#2,#3}
\DeclarePairedDelimiterXPP{\binomialdistribution}[2]{\operatorname{Bin}}{\lparen}{\rparen}{}{#1,#2} % binomial distribution with p=#1, n=#2
\DeclarePairedDelimiterXPP{\poissondistribution}[1]{\operatorname{Poi}}{\lparen}{\rparen}{}{#1} % poisson distribution with lambda=#1
\DeclarePairedDelimiterXPP{\geometricdistribution}[1]{\operatorname{Geo}}{\lparen}{\rparen}{}{#1} % geometric distribution with lambda=#1
\DeclarePairedDelimiterXPP{\exponentialdistribution}[1]{\operatorname{Exp}}{\lparen}{\rparen}{}{#1} % exponential distribution with lambda=#1
\DeclarePairedDelimiterXPP{\normaldistribution}[2]{\mathcal{N}}{\lparen}{\rparen}{}{#1,#2} % normal distribution with mu=#1, sigma=#2
\DeclarePairedDelimiterXPP{\uniformdistribution}[2]{U}{\lparen}{\rparen}{}{#1,#2} % uniform distribution on [#1,#2]
\let\complement\relax
\DeclarePostFunction-{\complement}[1]{^{c}}{#1}

% from AGLA
\newcommand{\permutations}[1]{S_{#1}} % permutations of {1,...,#1}

% from DIFF
\newcommand*{\ndifferentiable}[1]{C\ifstrempty{#1}{}{^{#1}}}
\newcommand*{\smooth}{\ndifferentiable{\infty}}
\DeclareFunction+{\smoothfunctions}[1,]{\smooth}{#1} % smooth maps from #1 to the reals
\DeclareFunction+{\smoothmaps}[2,]{\smooth}{#1,#2} % smooth maps from #1 to #2
\newcommand*{\continuous}{\ndifferentiable{0}}
\newcommand{\complexprojectivespace}[1]{{\complexes \mathbb{P}}^{#1}}
\newcommand{\realprojectivespace}[1]{{\reals \mathbb{P}}^{#1}}
\DeclareFunction+{\ndifferentiablemaps}[3,]{\ndifferentiable{#1}}{#2,#3} % #1-times continuously differentiable maps from #2 to #3
\DeclareFunction+{\ndifferentiablefunctions}[2,]{\ndifferentiable{#1}}{#2} % #1-times continuously differentiable  functions of #2
\DeclareFunction+{\stetigefunktionen}[2,1]{\ndifferentiable{#1}}{#2} % #1-fach stetig differenzierbare Funktionen of #2
\DeclareFunction-{\pushforward}[2,]{{#1}_{*}}{#2} % push-forward of #2 along #1    
\DeclareFunction+{\volume}[1,]{\operatorname{vol}}{#1}
\DeclareFunction+{\characteristicfunction}[2,]{\chi_{#1}}{#2}
\DeclareFunction+{\differentialforms}[2,]{\omega_{#1}}{#2} % differential forms of degree #1 of open set #2
\DeclareFunction+{\tensors}[3,]{T_{#1}^{#2}}{#3} % #1-times covariant, #2-times contravariant tensors of vector space #3 
\DeclareFunction+{\exponentialmap}[2,]{\exp_{#1}}{#2} % exponential map at point #1
\DeclareFunction+{\covarianttensors}[2,]{T_{#1}}{#2} % #1-times covariant tensors of vector space #2 
\DeclareFunction+{\contravarianttensors}[2,]{T^{#1}}{#2} % #1-times contravariant tensors of vector space #2
\newcommand*{\lebesgueintegrablefunctions}[1][1]{L^{#1}}
\newcommand*{\stufenfunktionen}[1][0]{\mathcal{R}_{#1}}
\newcommand{\sphere}[1]{\mathbb{S}^{#1}} % unit sphere of dimension #1
\DeclareFunction+{\ball}[2,]{B_{#1}}{#2} % ball of radius #1 around point #2

\DeclareFunction-{\pullback}[2,]{#1^{*}}{#2} % pullback of #2 along #1
\let\diffpullback\pullback % for compatibility, but deprecated

\DeclareFunction+{\legendrepolynomial}[2,]{P_{#1}}{#2}
\DeclareFunction+{\hermitepolynomial}[2,]{H_{#1}}{#2}
\DeclareFunction+{\laguerrepolynomial}[2,]{L_{#1}}{#2}
\DeclareFunction+{\besselfirstkind}[2,]{J_{#1}}{#2}

\DeclareFunction+{\alternatingforms}[2,]{\operatorname{Alt}^{#1}}{#2} % alternating #1-forms over #2
\DeclareFunction-{\codimension}[1,]{\operatorname{codim}}{#1} % codimension of space #1 (in some other space)
\DeclareFunction-{\codimensionover}[2,]{\operatorname{codim}}{#1,#2} % codimension of space #1 in #2
\DeclareFunction-{\dimension}[1,]{\operatorname{dim}}{#1} % dimension of space #1
\DeclareFunction+{\autodiffeomorphisms}[1,]{\operatorname{Diff}}{#1} % group of diffeomorphisms from #1 into #1
\DeclareFunction-{\normalspace}[2,]{N_{#1}}{#2} % normal space of manifold #2 at point #1
\DeclareFunction-{\tangentspace}[2,]{T_{#1}}{#2} % tangent space of manifold #2 at point #1
\DeclareFunction-{\cotangentspace}[2,]{T^*_{#1}}{#2} % tangent space of manifold #2 at point #1
\DeclareFunction-{\tangentbundle}[1,]{T}{#1} % tangent bundle of manifold #1
\DeclareFunction-{\cotangentbundle}[1,]{T^*}{#1} % tangent bundle of manifold #1
\DeclareFunction+{\vectorfields}[1,]{\mathcal{X}}{#1} % tangent bundle of manifold #1
\DeclareFunction+{\decktransformations}[2,0]{\operatorname{Deck}}{\quot{#1}{#2}} % deck transformations of Y over X.

\DeclareFunction+{\sectionalcurvature}[1,]{K}{#1} % sectional curvature of two dimensional subspace #1 of tangentspace at a manifold
\DeclareFunction+{\scalarcurvature}[1,]{K}{#1} % scalar curvature at point #1
\DeclareFunction+{\riccicurvature}[2,]{\operatorname{Ric}_{#1}}{#2} % Ricci curvature along vector #2 of tangent space at point #1
\DeclarePairedDelimiterX{\appliedriemanntensor}[4]{\lparen}{\rparen}{#1,#2,#3,#4} % (#1,#2,#3,4)=<R(#1,#2,#3),#4>


\DeclareFunction+{\curvelengthfromto}[3,]{\ell_{#1}^{#2}}{#3} % length of curve #3 from #1 to #2
\DeclareFunction+{\curvelength}[1,]{\ell}{#1} % length of curve #1

\DeclareFunction+{\cauchyfolgenmenge}[1,]{\mathcal{C}}{#1} % \cauchyfolgenmenge of #1 
\DeclareFunction+{\homogenreddglloesungsraum}[1,]{\mathcal{L}_{\textnormal{H}}}{#1} % space of solutions of homogenous dgl x'=#1.x, #1 matrix
\DeclareFunction+{\inhomogenreddglloesungsraum}[2,0]{\mathcal{L}_{\textnormal{I}}}{#1,#2} % space of solutions of homogenous dgl x'=#1.x+#2, #1 matrix, #2 vector 
\DeclareFunction+{\homogendglloesungsraum}[2,]{\mathcal{L}_{\textnormal{H},#1}}{#2} % space of solutions of homogenous dgl of order #3 x^{k}+#1.(k-1)x^{k-1}+...+#1.1x'+#1.0x=0, #1 array of matrices
\DeclareFunction+{\inhomogendglloesungsraum}[3,1]{\mathcal{L}_{\textnormal{I},#1}}{#2,#3} % space of solutions of homogenous dgl of order #3 x^{k}+#1.(k-1)x^{k-1}+...+#1.1x'+#1.0x=#2, #1 array of matrices, #2 vector 
\DeclareFunction+{\wronskideterminant}[1,]{W}{#1} % Wronski-Determinante an Zeitpunkt #1
\DeclareFunction+{\Ln}[1,]{\ln}{#1} % Logarithmus naturalis of #1
\DeclareFunction+{\moebiusabbildungenmenge}[1,]{\mathcal{C}}{#1} % \moebiusabbildungenmenge of #1 
\DeclareFunction-{\randpunkte}[1,]{\partial}{#1} % \randpunkte of #1 
\DeclareFunction-{\boundary}[1,]{\partial}{#1} % \randpunkte of #1 
\DeclarePostFunction-{\interior}[1]{^{\circ}}{#1}
\DeclarePostFunction-{\inneres}[1]{^{\circ}}{#1}
\newcommand{\closure}[1]{\widebar{#1}}
\let\abschluss\closure
\newcommand*{\matrixmult}{\mathbin{.}}
\newcommand*{\laplaceoperator}{\Delta}
\newcommand*{\kroneckerdelta}[1]{\delta_{#1}} % Kronecker Delta of indices #1

% visited courses
\newcommand{\aglacourse}[1]{AGLA \Romannum{#1}}
\newcommand{\diffcourse}[1]{DIFF \Romannum{#1}}

% operators
\DeclareFunction+{\sgn}[1,]{\operatorname{sgn}}{#1} % \sgn of #1 
\DeclareFunction+{\Abb}[1,]{\operatorname{Abb}}{#1} % \Abb of #1 
\DeclareFunction+{\Ker}[1,]{\operatorname{Ker}}{#1} % \Ker of #1 
\DeclareFunction+{\Kern}[1,]{\operatorname{Kern}}{#1} % Kern of #1 
\DeclareFunction+{\Urbild}[1,]{\operatorname{Urbild}}{#1} % Bild of #1 
\DeclareFunction+{\Bild}[1,]{\operatorname{Bild}}{#1} % Bild of #1 
\DeclareMathOperator{\Id}{Id} % Identity
\DeclareFunction+{\traeger}[1,]{\operatorname{supp}}{#1} % Träger of function #1
\DeclareFunction+{\kernel}[1,]{\operatorname{ker}}{#1} % \image of #1 
\DeclareFunction+{\image}[1,]{\operatorname{im}}{#1} % \image of #1 
\DeclareFunction+{\Image}[1,]{\operatorname{im}}{#1} % \image of #1 
\DeclareFunction+{\preimage}[1,]{\operatorname{Pre}}{#1} % \preimage of #1 
\DeclareFunction+{\grad}[1,]{\operatorname{grad}}{#1} % grad of #1 
\DeclareFunction+{\divergence}[1,]{\operatorname{div}}{#1} % divergence of vector field #1 
\DeclareFunction+{\gradient}[1,]{\nabla}{#1} % grad of #1 
% from AGLA
\DeclareFunction+{\exterior}[2,]{\Lambda^{#1}}{#2} % Bijections of #1 
\DeclareFunction+{\bijections}[1,]{\operatorname{Bij}}{#1} % Bijections of #1 
\DeclareFunction+{\bilinearities}[3,0]{\operatorname{Bil}}{#1,#2;#3} % bilinearities of #1 x #2 into #3
\DeclareFunction+{\Endomorphisms}[1,]{\operatorname{End}}{#1} % Endomorphismus of #1 
\DeclareFunction+{\automorphisms}[1,]{\operatorname{Aut}}{#1} % Automorphismus of #1 
\DeclareFunction+{\innerautomorphism}[1,]{\operatorname{Int}}{#1} % Automorphismus of #1 
\DeclareFunction+{\homomorphisms}[2,0]{\operatorname{Hom}}{#1,#2} % Homomorphismen of #1 into #2
\DeclareFunction+{\homomorphismsover}[3,1]{\operatorname{Hom}_{#1}}{#2,#3} % Homomorphismen of #2 into #3 over base space #1
\DeclareFunction+{\morphisms}[2,0]{\operatorname{Mor}}{#1,#2} % Homomorphismen of #1 into #2
\DeclareFunction+{\morphismsof}[3,1]{\operatorname{Mor}_{#1}}{#1,#2} % morphisms of #2 into #3 in category #1
\DeclareFunction+{\fieldhomomorphisms}[3,]{\operatorname{Hom}_{#1}}{#2,#3} % Homomorphismen of #2 into #3 over field #1
\DeclareMathOperator{\Mat}{Mat} % matrices
\DeclarePairedDelimiterXPP{\matrices}[3]{\Mat}{\lparen}{\rparen}{}{#1 \times #2, #3} % #1*#2 matrices over field #3 
\newcommand{\sqmatrices}[2]{\matrices{#1}{#1}{#2}} % #1*#1-square matrices over field #2

\DeclareFunction+{\determinant}[1,]{\det}{#1} % determinant of #1
\DeclareFunction+{\trace}[1,]{\operatorname{tr}}{#1} % determinant of #1
\DeclareFunction+{\invertiblematrices}[1,]{\operatorname{GL}}{#1}
\DeclareFunction+{\generallineargroup}[1,]{\operatorname{GL}}{#1}
\DeclareFunction+{\generallineargroupover}[2,]{\operatorname{GL}_{#1}}{#2}
\DeclareFunction+{\speciallineargroup}[1,]{\operatorname{SL}}{#1}
\DeclareFunction+{\speciallineargroupover}[2,]{\operatorname{SL}_{#1}}{#2}
\DeclareFunction+{\generallinearliealgebra}[1,]{\mathfrak{gl}}{#1}
\DeclareFunction+{\speciallinearliealgebra}[1,]{\mathfrak{sl}}{#1}
\DeclareFunction+{\unitaryliealgebra}[1,]{\mathfrak{u}}{#1}
\DeclareFunction+{\specialunitaryliealgebra}[1,]{\mathfrak{su}}{#1}
\DeclareFunction+{\orthogonalliealgebra}[1,]{\mathfrak{o}}{#1}
\DeclareFunction+{\specialorthogonalliealgebra}[1,]{\mathfrak{so}}{#1}
\DeclareFunction+{\specialsymplecticliealgebra}[1,]{\mathfrak{sp}}{#1}
\DeclareFunction+{\unitarygroup}[1,]{\operatorname{U}}{#1} % unitary matrices of #1 
\DeclareFunction+{\specialunitarygroup}[1,]{\operatorname{SU}}{#1} % unitary matrices of #1 with determinant 1
\DeclareFunction+{\orthogonalgroup}[1,]{\operatorname{O}}{#1} % orthogonal matrices of #1 
\DeclareFunction+{\specialorthogonalgroup}[1,]{\operatorname{SO}}{#1} % orthogonal matrices of #1 with determinant 1
\DeclareFunction+{\symplecticgroup}[2,0]{\operatorname{Sp}}{#1,#2} % symplectic matrices of dimension #1 over #2
\DeclareFunction+{\diagonalmatrix}[1,]{\operatorname{diag}}{#1} % diagonal matrix with diagonal entries #1
\DeclareFunction+{\Adj}[1,]{\operatorname{Adj}}{#1} % adjunction of #1 
\DeclareFunction+{\specialinvertiblematrices}[2,]{\operatorname{SL}\ifstrempty{#1}{}{_{#1}}}{#2} % special linear group of #1 dimensions over field #2
\DeclareFunction+{\selfadjointendomorphisms}[1,]{\operatorname{ST}}{#1} % selbstadjungierte Endomorphismen of #1 
\DeclareFunction+{\spaltenrang}[1,]{\operatorname{SR}}{#1} % Spaltenrang of #1 
\DeclareFunction+{\zeilenrang}[1,]{\operatorname{ZR}}{#1} % Zeilenrang of #1 
\DeclareFunction+{\rank}[1,]{\operatorname{rank}}{#1} % rank of #1 
\DeclareFunction+{\rang}[1,]{\operatorname{rang}}{#1} % rang of #1 
% \DeclareMathOperator{\Rg}{Rg} % Rang
% \DeclarePairedDelimiterXPP{\Rgof}[1]{\Rg}{\lparen}{\rparen}{}{#1} % Rg of #1 
% \DeclareMathOperator{\Rang}{Rang}
% \DeclarePairedDelimiterXPP{\Rangof}[1]{\Rang}{\lparen}{\rparen}{}{#1} % Rang of #1 
% \DeclareMathOperator{\rg}{rg}
% \DeclarePairedDelimiterXPP{\rgof}[1]{\rg}{\lparen}{\rparen}{}{#1} % rg of #1 
\DeclareFunction+{\Span}[1,]{\operatorname{Span}}{#1} % Span of #1 
\DeclareFunction+{\fieldspan}[2,]{\operatorname{Span}_{#1}}{#2} % Span of #1 over field #2 
\let\dim\relax
\DeclareFunction+{\dim }[1,]{\operatorname{dim}}{#1} % dimension of #1 
\DeclareFunction+{\dimensionover}[2,]{\operatorname{dim}_{#1}}{#2} % dimension of #2 over ring #1
\DeclareFunction+{\affindim}[1,]{\operatorname{dim}}{#1} % dimension of affine space #1 
\DeclareFunction+{\projectivedim}[1,]{\operatorname{dim}}{#1} % dimension of projection space #1 

\DeclareFunction+{\Spur}[1,]{\operatorname{Spur}}{#1} % Spur of #1 
\DeclarePairedDelimiterXPP{\teilverhaeltnis}[3]{\operatorname{TV}}{\lparen}{\rparen}{}{#1,#2,#3} % Teilverhältnis
\DeclarePairedDelimiterXPP{\doppelverhaeltnis}[4]{\operatorname{DV}}{\lparen}{\rparen}{}{#1,#2,#3,#4} % Doppelverhältnis
\DeclareFunction+{\characteristic}[1,]{\operatorname{char}}{#1} % characteristic of #1 
\DeclareFunction+{\fixpunkte}[1,]{\operatorname{Fix}}{#1} % Fixpunkte of #1 
\DeclareFunction+{\signature}[1,]{\operatorname{sign}}{#1} % signature of quadrik #1
\let\Exp\relax
\DeclareFunction+{\exponential}[1,]{\exp}{#1} % exponential function of #1
\let\Exp\exponential
\DeclarePairedDelimiterXPP{\polynomials}[2]{#1}{\lbrack}{\rbrack}{}{#2} % Polynomials of variables #2 over field #1 
\DeclarePairedDelimiterXPP{\polynomialfield}[2]{#1}{\lparen}{\rparen}{}{#2} % Quotient field of the Polynomials of variables #2 over field #1 
\DeclarePairedDelimiterXPP{\noncommutativepolynomials}[2]{#1}{\langle}{\rangle}{}{#2} % Polynomials of non-commutative variables #2 over field #1 


% from DIFF
\DeclareFunction+{\setdiameter}[1,]{\operatorname{diam}}{#1} % Durchmesser of #1
\DeclareFunction+{\normdiameter}[2,]{\operatorname{diam}_{#1}}{#2} % Durchmesser of #2 under norm #1

% \DeclareFunction+{\distance}[1,]{\operatorname{dist}}{#1} % Distanz of #1

% from Zahlentheorie
\DeclareFunction+{\ord}[1,]{\operatorname{ord}}{#1} % order of quadrik #1
\DeclarePairedDelimiterXPP{\quadraticform}[3]{}{\langle}{\rangle}{}{#1,#2,#3} % quadratic form #1x^2+#2xy+#3y^2

\DeclareFunction+{\complexity}[1,]{\mathcal{O}}{#1} % Bachmann-Landau notation for complexity


\DeclareFunction+{\ggt}[1,]{\operatorname{ggT}}{#1} % größter gemeinsamer Teiler of #1 (#1 a collection)
\let\gcd\relax
\DeclarePairedDelimiterXPP{\gcd}[1]{}{\lparen}{\rparen}{}{#1}
% commands

% evaluate using vert
\newcommand{\evaluateat}[2]{\left.#1\right|_{#2}}
\DeclarePostFunction+{\restrict}[2]{\right|_{#2}}{\left.#1}
\newcommand{\evaluatebetween}[3]{\left.#1\right|_{#2}^{#3}}


\newif\ifincludemit
\newif\ifincludeparantheses
\newif\ifincludevert
\newif\iftextmode
\pgfkeys{/eqstep/.cd,
	m/.is if=includemit,
	p/.is if=includeparantheses,
	v/.is if=includevert}

\newcommand{\eqstep}[2][]{
	{\pgfkeys{
				/eqstep/.cd,
				m=true,
				p=true,
				v=true,
				#1
			}}
	&& \ifincludevert\left|\else\fi \;\ifincludeparantheses\left(\else\fi\ifincludemit\text{mit }\else\fi #2\ifincludeparantheses\right)\else\fi\ifincludevert\right.\else\fi
}


\DeclarePostFunction-{\inverse}[1]{^{-1}}{#1} % inverse of argument
\let\inv\inverse

\DeclarePairedDelimiter{\abs}{\lvert}{\rvert} % absolute value
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiterXPP{\explicitnorm}[2]{}{\|}{\|}{_{#1}}{#2}
\let\pnorm\explicitnorm
\DeclarePairedDelimiterXPP{\euclidiannorm}[1]{}{\|}{\|}{_{\textnormal{E}}}{#1}
\DeclarePairedDelimiterXPP{\lebesguenorm}[1]{}{\|}{\|}{_{\lebesgueintegrablefunctions}}{#1}
\DeclarePairedDelimiterXPP{\supnorm}[1]{}{\|}{\|}{_{\infty}}{#1}
\DeclarePairedDelimiterXPP{\maxnorm}[1]{}{\|}{\|}{_{\max}}{#1}
\DeclarePairedDelimiterXPP{\operatornorm}[1]{}{\|}{\|}{_{\textnormal{op}}}{#1}

\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}

\DeclarePairedDelimiter{\parens}{(}{)}
\let\p\parens % shortcut, lots of "\parens" make the .tex really cluttered

\DeclareFunction+{\distance}[2,0]{d}{#1,#2}
\DeclareFunction+{\lineangle}[2,0]{\angle}{#1,#2}
\newcommand{\quotient}[2]{\ThisStyle{{\raisebox{.2em}{$\SavedStyle #1$}\left/\raisebox{-.2em}{$\SavedStyle #2$}\right.}}}
\newcommand{\quot}[2]{{
			\mathchoice
			{% \displaystyle
				\quotient{#1}{#2}%
			}
			{% \textstyle
				\quotient{#1}{#2}%
			}
			{% \scriptstyle
				#1\mathbin{/}#2%
			}
			{% \scriptscriptstyle  
				#1\mathbin{/}#2%
			}
		}} % quotient set and "side fractions"      

\newcommand{\logicaland}{\mathbin{\wedge}}
\newcommand{\logicalor}{\mathbin{\vee}}



\DeclarePostFunction-{\factorial}[1]{!}{#1} % factorial of #1
\DeclarePostFunction-{\doublefactorial}[1]{!!}{#1} % double factorial of #1


% from DIFF
\DeclareFunction+{\residue}[2,]{\operatorname{Res}_{#1}}{#2} % residue of function #2 at point #1
\DeclareFunction+{\windingnumber}[2,]{\operatorname{Ind}_{#1}}{#2} % winding number of path #1 at point #2
\DeclareFunction+{\regelfunktionen}[1,]{\operatorname{\mathcal{R}}}{#1}
\DeclareFunction+{\treppenfunktionen}[1,]{\operatorname{\mathcal{T}}}{#1}
\DeclarePostFunction-{\parendiff}[2]{^{\parens*{#2}}}{#1} % #2th derivative of #1
\DeclareFunction+{\diracmeasure}[2,]{\delta_{#1}}{#2}
\DeclareFunction+{\lebesguemeasure}[1,]{\lambda}{#1}
\DeclareFunction+{\borelalgebra}[1,]{\mathcal{B}}{#1} % borel algebra over field #1
\DeclareFunction+{\lebesguefunctionspace}[2,]{L^{#1}}{#2} % lebesgue (L^#1) space over a measure #2
\DeclareFunction;{\lebesguesequencespace}[2,]{\ell^{#1}}{#2} % sequence (l^#1) space over a field #2
\DeclareFunction;{\convergentsequencespace}[1,]{c}{#1} % space of convergent sequences over a field #1
\DeclareFunction;{\nullsequencespace}[1,]{c}{#1} % space of null sequences over a field #1
\DeclareFunction;{\eventuallyzerosequencespace}[1,]{c_{00}}{#1} % space of eventually zero sequences over a field #1
\DeclarePairedDelimiterX{\commutator}[2]{\lbrack}{\rbrack}{#1,#2} % commutator of elements #1, #2 of non commutative ring

% from AlgGeo
\DeclarePostFunction-{\ringunits}[1]{^*}{#1} % invertible elements of a ring #1
\DeclareFunction+{\height}[1,]{\operatorname{ht}}{#1} % height of a prime ideal #1
\DeclareFunction+{\transcendencedegreeover}[2,]{\operatorname{tr.deg}_{#1}}{#2} % transcendence degree of #2 over #1
\DeclareFunction;{\jacobsonradical}[1,]{J}{#1} % jacobson radical of ring #1
\DeclareFunction-{\degree}[1,]{\operatorname{deg}}{#1} % degree of element #1 of graded ring
\DeclarePostFunction-{\gradedpart}[2]{_{#2}}{#1} % graded part of degree #1 of graded ring #2
\DeclareFunction+{\quotientfield}[1,]{\operatorname{Quot}}{#1} % quotient field of field #1
\newcommand{\projectivespace}[1]{\mathbb{P}^{#1}}
\newcommand{\projectivespaceover}[2]{\mathbb{P}^{#1}_{#2}} % projective #1-space over #2
\newcommand{\affinespace}[1]{\mathbb{A}^{#1}}
\newcommand{\affinespaceover}[2]{\mathbb{A}^{#1}_{#2}} % affine #1-space over #2
\newcommand{\stalk}[2]{\mathcal{O}_{#1,#2}}
\DeclarePostFunction-{\genericstalk}[2]{_{#2}}{#1} % stalk of sheaf #1 at point #2 of some scheme
\newcommand{\derivations}[3]{\operatorname{Der}_{#3}(\stalk{#1}{#2},#3)}
\newcommand{\fibreproduct}{\times}
\newcommand{\fibreproductover}[1]{\times_{#1}}
\newcommand{\tensorproductover}[1]{\otimes_{#1}}
\DeclareFunction+{\functionfield}[1,]{k}{#1} % function field of integral scheme
\DeclareFunction+{\structuresheaf}[2,]{\mathcal{O}\ifstrempty{#1}{}{_{#1}}}{#2} % structure sheaf over topological space #1 at open set #2 (#1 can be empty)
\DeclareFunction+{\sheaf}[2,]{\mathcal{O}\ifstrempty{#1}{}{_{#1}}}{#2} % structure sheaf over topological space #1 at open set #2 (#1 can be empty)
\DeclareFunction+{\quotientsheaf}[3,]{\quot{#1}{#2}}{#3} % quotient sheaf of sheaves #1 and #2 on open subset #3
\DeclareFunction+{\tangentsheaf}[2,]{T_{#1}}{#2} % tangent bundle to smooth variety #1 of open subset #2 of #1
\newcommand{\tangentstalk}[2]{T_{#1,#2}} % stalk of tangent bundle to smooth variety #1 at #2
\DeclareFunction+{\serretwistingsheaf}[3,]{\mathcal{O}\ifstrempty{#1}{}{_{\projectivespace{#1}}}(#2)}{#3} % Serre twisting sheaf of degree #2 over #1-dimensional projective space (#1 can be empty)
\DeclareFunction+{\twistingsheaf}[3,]{\mathcal{O}\ifstrempty{#1}{}{_{#1}}(#2)}{#3} % Serre twisting sheaf of degree #2 over projective scheme #1
\DeclareFunction+{\twistedmodule}[2,]{#1}{#2} % twisted graded #1-module with n=#2
\DeclareFunction+{\skyscrapersheaf}[2,]{\mathcal{k}_{#1}}{#2} % skyscraper sheaf at point #1 (of open set #2 of scheme containing point #1)
\DeclareFunction+{\explicittwistingsheaf}[3,]{\p*{\mathcal{O}\ifstrempty{#1}{}{_{\projectivespace{#1}}}(#2)}}{#3} % Serre twisting sheaf with parantheses
\DeclareFunction+{\imagepresheaf}[1,]{\operatorname{im}'}{#1} % sadly does not work properly as a presheaf (need to manually set parentheses)
\DeclareFunction+{\constantsheaf}[1,]{\mathcal{K}^*}{#1} % constant sheaf on open set #1
\DeclareFunction+{\imagesheaf}[1,]{\operatorname{im}}{#1} % sadly does not work properly as a presheaf (need to manually set parentheses)
\DeclareFunction+{\kernelsheaf}[1,]{\operatorname{ker}}{#1} % sadly does not work properly as a presheaf (need to manually set parentheses)
\DeclareFunction+{\sheafofideals}[2,]{I_{#1}}{#2} % sheaf of ideals of closed subset #1 evaluated on #2
\DeclarePostFunction+{\reducedscheme}[1]{_{\mathnormal{red}}}{#1} % #1 with induced reduced scheme structure
\DeclareFunction+{\idealsheaf}[3,]{I_{\quot{#1}{#2}}}{#3} % ideal sheaf of #1 in #2 evaluated on #3
\DeclareFunction+{\tildesheaf}[2,]{\reallywidetilde{#1}}{#2} % sheaf associated to module #1 evaluated on #2
\DeclareFunction+{\vectorbundlesheaf}[2,]{\mathcal{E}\ifstrempty{#1}{}{_{#1}}}{#2} % sheaf associated to vector bundle #1 evaluated on #2
\DeclareFunction+{\weildivisorsheaf}[2,]{\mathcal{O}(#1)}{#2} % sheaf associated to weil divisor #1
\DeclareFunction+{\weildivisorsheafover}[3,]{\mathcal{O}_{#1}(#2)}{#3} % sheaf associated to weil divisor #2 over scheme #1
\DeclareFunction+{\cartierdivisorsheaf}[2,]{\mathcal{O}(#1)}{#2} % sheaf associated to cartier divisor #1
\DeclareFunction+{\cartierdivisorsheafover}[3,]{\mathcal{O}_{#1}(#2)}{#3} % sheaf associated to cartier divisor #2 over scheme #1
\DeclareFunction+{\divisorsheaf}[2,]{\mathcal{O}(#1)}{#2} % sheaf associated to divisor #1
\DeclareFunction-{\picardgroup}[1,]{\operatorname{Pic}}{#1} % Picard group of sheaf #1
\DeclareFunction;{\tautologicalprojectivebundle}[1,]{\mathbb{L}}{#1} % universal family of lines over P^{#1}
\DeclarePostFunction-{\dualbundle}[1]{^\vee}{#1} % dual bundle of a vector bundle #1
\DeclarePostFunction-{\dualsheaf}[1]{^{\vee}}{#1} % dual vector of a vector #1
\DeclareFunction+{\homsheaf}[2,]{\operatorname{\mathcal{H}\kern -.5pt \mathit{om}}}{#1,#2} % Hom sheaf from #2 to #3
\DeclareFunction+{\homsheafover}[3,1]{\operatorname{\mathcal{H}\kern -.5pt \mathit{om}}_{#1}}{#2,#3} % Hom sheaf over O_#1 from #2 to #3
\DeclareFunction-{\spectrum}[1,]{\operatorname{Spec}}{#1} % spectrum over ring #1
\DeclareFunction+{\coordinatering}[1,]{A}{#1} % coordinate ring of variety #1
\DeclareFunction+{\homogeneouscoordinatering}[1,]{S}{#1} % homogeneous coordinate ring of a projective variety #1
\DeclareFunction+{\zeroes}[1,]{Z}{#1} % vanishing / zeroes of ideal or function (or element of a ring) #1
\DeclareFunction+{\vanishing}[1,]{V}{#1} % vanishing / zeroes of ideal or function (or element of a ring) #1
\DeclareFunction+{\projectivezeroes}[1,]{Z_+}{#1} % vanishing / zeroes of homogeneous ideal or function #1
\DeclareFunction+{\schemeideal}[1,]{I}{#1} % Ideal of a subset #1 of an affine scheme / variety
\DeclarePostFunction-{\schemeification}[1]{_{\textnormal{sch}}}{#1} % Ideal of a subset #1 of a scheme / variety
\DeclarePostFunction-{\sheafification}[1]{_{\textnormal{sh}}}{#1} % Sheafification of a presheaf #1 on a scheme
\DeclareFunction+{\modulesheafification}[2,]{\reallywidetilde{#1}}{#2} % Sheafification of R-module #1 giving module sheaf on X=Spec(R)
\newcommand{\schemenormalisation}[1]{\widebar{#1}} % normalisation of an integral scheme #1
\newcommand{\idnormalisation}[1]{\reallywidetilde{#1}} % normalisation of integral domain #1
\DeclareFunction+{\distinguishedopen}[1,]{D}{#1} % distinguished open of a function (or an element of a ring) #1 
\newcommand{\radicalideal}[1]{\sqrt{#1}} % the radical of an ideal #1
\newcommand{\nilradical}{\radicalideal{(0)}} % radical of the ideal (0)
\newcommand{\saturation}[1]{\widebar{#1}} % saturation of the homogeneous ideal #1 inside a graded ring
\DeclarePostFunction-{\gradedlocalization}[2]{_{(#2)}}{#1} % ring #1 localized at ideal or element of ring #2
\DeclarePostFunction-{\localization}[2]{_{#2}}{#1} % ring #1 localized at ideal or element of ring #2
\DeclareFunction+{\residuefield}[1,]{\kappa}{#1} % residue field at prime ideal p (point in spectrum)
\DeclarePostFunction-{\irrelevantideal}[1]{_{+}}{#1} % the irrelevant ideal of graded ring #1
\DeclareFunction+{\projectivescheme}[1,]{\operatorname{Proj}}{#1} % projective scheme over graded ring #1
\DeclareFunction+{\projectivevanishing}[1,]{V_p}{#1} % vanishing / zeroes of ideal or function (or element of a ring) #1
\DeclareFunction+{\projectivedistinguishedopen}[1,]{D_+}{#1} % projective distinguished open of homogenous element #1  of positive degree of graded ring
\DeclarePostFunction-{\veronese}[2]{^{(#1)}}{#2} % image of veronese embedding of degree #1 of graded ring #2
\DeclareFunction+{\veroneseembedding}[2,]{V_{#1}}{#2} % Veronese embedding of degree d of element #2 of projective scheme
\newcommand{\finitefield}[1]{\mathbb{F}_{#1}} % finite field with #1 elements
\DeclareFunction+{\weildivisor}[1,]{\operatorname{div}}{#1} %  weil divisors corresponding to invertible function #1 in function field
\DeclareFunction+{\weildivisors}[1,]{\operatorname{Div}}{#1} % group of weil divisors over scheme (integral, normal, Noetherian) #1
\DeclareFunction+{\weilclassgroup}[1,]{\operatorname{Cl}}{#1} % Weil class group over scheme (integral, normal, Noetherian) #1
\DeclareFunction+{\principalweildivisors}[1,]{\operatorname{Div}_0}{#1} % group of weil divisors div(f) over scheme (integral, normal, Noetherian) #1 

\DeclareFunction+{\cartierdivisors}[1,]{\operatorname{CaDiv}}{#1} % group of cartier divisors over scheme #1
\DeclareFunction+{\principalcartierdivisors}[1,]{\operatorname{CaDiv}_0}{#1} % group of principal cartier divisors over scheme #1
\DeclareFunction+{\cartierclassgroup}[1,]{\operatorname{CaCl}}{#1} % class group of cartier divisors over scheme #1

% from AGLA
\newcommand{\euclideanspace}[1]{\mathbb{E}^{#1}} % euclidean (affine) space of dimension 2
\DeclarePairedDelimiterX{\generated}[1]{\langle}{\rangle}{#1}
\DeclarePairedDelimiterX{\scalarproduct}[2]{\langle}{\rangle}{#1,#2}
\DeclarePairedDelimiterX{\spatproduct}[3]{\lparen}{\rparen}{#1,#2,#3}
\newcommand{\compactification}[1]{\widebar{#1}} % Compactification of a topological space #1
\DeclarePostFunction-{\fieldwithoutzero}[1]{^{\star}}{#1} % Compactification of a topological space #1
\DeclareFunction+{\projectioncone}[1,]{\mathbb{P}}{#1} % projection of a cone #1
\DeclareFunction+{\projectionspace}[1,]{\mathbb{P}}{#1} % projection of a vector space #1
\DeclareFunction+{\projectionspaces}[1,]{\mathcal{P}}{#1} % set of projection subspaces of \projectionspace{#1} 
\DeclareFunction+{\projectionmap}[1,]{\mathbb{P}}{#1} % projection equivalent of a linear map #1
\DeclareFunction+{\projectionspaceover}[2,]{\mathbb{P}_{#1}}{#2} % projection of a vector space #2^{#1+1}, #2 a field
\DeclareFunction+{\freevectorspace}[1,]{F}{#1} % free vector space over #1
\DeclarePostFunction-{\orthogonalspace}[1]{^{\circ}}{#1} % orthogonal space (in the dual space) of a vector subspace #1
\DeclarePostFunction-{\dualspace}[1]{^{*}}{#1} % dual space of a vector space #1
\DeclarePostFunction-{\bidualspace}[1]{^{\star\star}}{#1} % bidual space of a vector space #1
\DeclarePostFunction-{\dualvector}[1]{^{\star}}{#1} % dual vector of a vector #1
\newcommand{\equivclass}[1]{\widebar{#1}} % under an equivalence relation
\DeclarePostFunction+{\perpspace}[1]{^{\perp}}{#1} % perpendicular space to #1
\DeclarePostFunction-{\transpose}[1]{^{T}}{#1} % transposed matrix of #1
\DeclarePostFunction-{\adjoint}[1]{^{\dagger}}{#1} % adjoint matrix of #1

% basechange lower index Notation
\newcommand{\basechange}[3]{\leftidx{{_{#1}}}{{#2}}{{_{#3}}}} % Map #2 from space under base #3 to space under base #1
\newcommand{\tensorproperty}{\( \otimes \)\xspace}
\RequirePackage{xspace}
\newcommand{\tensorproduct}{\otimes}
\newcommand{\directsum}{\oplus}
\newcommand{\bigtensorproduct}{\bigotimes}
\newcommand{\bigdirectsum}{\bigoplus}
\newcommand{\fieldtensorproduct}[1]{\otimes}

% text macros (should not be used in real texts, ok for scripts and notes)
\DeclareRobustCommand{\texistsunique}{\( \exists! \)~}
\DeclareRobustCommand{\tforall}{\( \forall \)~}
\DeclareRobustCommand{\texists}{\( \exists \)~}
\DeclareRobustCommand{\tnexists}{\( \nexists \)~}
\DeclareRobustCommand{\timplies}{\( \implies \)~}
\DeclareRobustCommand{\teq}{\( = \)~}
\DeclareRobustCommand{\tsubset}{\( \subset \)~}
\DeclareRobustCommand{\tiff}{\( \iff \)~}
\DeclareRobustCommand{\tto}{\( \to \)~}
